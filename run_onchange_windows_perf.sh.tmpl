{{- if (and (eq .chezmoi.os "linux") (.chezmoi.kernel.osrelease | lower | contains "microsoft")) -}}
#!/bin/bash

# Hash de contr√¥le pour forcer l'ex√©cution si les valeurs changent :
# Delay: 170 | Rate: 10 | Sensitivity: 10 | Animations: OFF | Safety: ON

echo "üöÄ Configuration des performances Windows (Keyboard, Mouse & Snappy UI)..."

powershell.exe -NoProfile -ExecutionPolicy Bypass -Command '
    # 1. Keyboard Tweaks (Registry) - Mode Haute Performance
    $kbdPath = "HKCU:\Control Panel\Accessibility\Keyboard Response"
    Write-Host "Updating Keyboard Response Registry..." -ForegroundColor Cyan
    Set-ItemProperty -Path $kbdPath -Name "AutoRepeatDelay" -Value 170
    Set-ItemProperty -Path $kbdPath -Name "AutoRepeatRate" -Value 10
    # Flags 59 : Active FilterKeys + D√©sactive les sons/notifications pour √©viter les blocages
    Set-ItemProperty -Path $kbdPath -Name "Flags" -Value 59

    # 2. S√©curit√© : D√©sactivation des raccourcis Accessibilit√© (Shift 5x, Shift 8s)
    # Emp√™che Windows de bloquer le clavier si on reste appuy√© sur une touche
    Write-Host "Disabling Accessibility Shortcuts (Sticky/FilterKeys)..." -ForegroundColor Cyan
    Set-ItemProperty -Path "HKCU:\Control Panel\Accessibility\StickyKeys" -Name "Flags" -Value 506
    Set-ItemProperty -Path "HKCU:\Control Panel\Accessibility\Keyboard Response" -Name "Flags" -Value 59
    Set-ItemProperty -Path "HKCU:\Control Panel\Accessibility\ToggleKeys" -Name "Flags" -Value 58

    # 3. Disable Mouse Acceleration & Set Sensitivity (6th Notch = 10)
    Write-Host "Disabling Mouse Acceleration..." -ForegroundColor Cyan
    $mousePath = "HKCU:\Control Panel\Mouse"
    Set-ItemProperty -Path $mousePath -Name "MouseSpeed" -Value 0
    Set-ItemProperty -Path $mousePath -Name "MouseThreshold1" -Value 0
    Set-ItemProperty -Path $mousePath -Name "MouseThreshold2" -Value 0
    Set-ItemProperty -Path $mousePath -Name "MouseSensitivity" -Value 10

    # 4. Snappy UI (Disable Animations & Menu Delays)
    Write-Host "Disabling Windows Animations..." -ForegroundColor Cyan
    $desktopPath = "HKCU:\Control Panel\Desktop"
    $metricsPath = "HKCU:\Control Panel\Desktop\WindowMetrics"
    Set-ItemProperty -Path $desktopPath -Name "MenuShowDelay" -Value 0
    Set-ItemProperty -Path $metricsPath -Name "MinAnimate" -Value 0
    Set-ItemProperty -Path $desktopPath -Name "UserPreferencesMask" -Value ([byte[]](0x90,0x12,0x03,0x80,0x10,0x00,0x00,0x00))

    Write-Host "‚úÖ Configuration appliqu√©e avec succ√®s !" -ForegroundColor Green
    Write-Host "‚ö†Ô∏è  IMPORTANT : D√©connectez/Reconnectez votre session (ou red√©marrez) pour activer." -ForegroundColor Yellow
'
{{- end }}

